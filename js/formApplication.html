<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF_8">
        <meta name="viewport" content="width=device_width, initial_scale=1.0">
        <title>Loan Application</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font_awesome/4.7.0/css/font_awesome.min.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

        <style>
            @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap');

            :root{
                --primary: #4c2d62;
                --secondary: #bfc0c0;
                --white: #fff;
                --text-clr: #5b6475;
                --header-clr: #25273d;
                --next-btn-hover: #0056b3;
                --back-btn-hover: #0056b3;
            }

            *{
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                list-style: none;
                outline: none;
                font-family: 'Arial', sans-serif;
            }

            body{
                background: var(--primary);
                color: var(--text-clr);
                position: relative;
                font-family: 'Arial', sans-serif;
                line-height: 1.6;
            }

            .container {
                max-width: 1000px;
                margin: 0 auto;
                display: flex;
                flex-wrap: wrap;
              }
              
            .required::after {
            content:" *";
            color: red;
            }
            
            .error {
            border-color: red;
            }
            
            header {
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
                background-color: #311d3f;
                color: white;
                animation: slideIn 1s ease-out;
              }
              
              .logo-container {
                display: flex;
                justify-content: center;
                align-items: center;
              }
              
              .logo-container img {
                height: 50px;
              }
              
            
            
            .form-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: calc(100vh);
            }
            
            form {
            width: 100%;
            max-width: 600px;
            }
            
            
            h2 {
            font-size: 32px;
            font-weight: 600;
            line-height: 60px;
            margin: 25px 0px;
            text-align: center;
            }
            
            .mb-3 {
            margin-bottom: 20px;
            }
            
            .form_label {
            display: block;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 600;
            }
            
            .form_control {
            width: 100%;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 16px;
            transition: border-color 0.3s ease;
            }
            
            .form_control:focus {
            border-color: #007BFF;
            }
            
            .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
            }
            
            .btn:hover {
            transform: scale(1.05);
            }
            
            .btn_primary {
            background-color: #007BFF;
            color: white;
            }
            
            .btn_primary:hover {
            background-color: #0056b3;
            }
            
            .mb-3 .btn {
            width: 100%;
            margin-top: 20px;
            }
              
            .wrapper{
                width: 750px;
                max-width: 100%;
                background: var(--white);
                margin: 50px auto 0;
                padding: 50px;
                border-radius: 5px;
            }

            .wrapper .header{
                margin-bottom: 35px;
                display: flex;
                justify-content: center;
            }

            .wrapper .header ul{
                display: flex;
            }

            .wrapper .header ul li{
                margin-right: 50px;
                position: relative;
            }

            .wrapper .header ul li:last-child{
                margin-right: 0;
            }

            .wrapper .header ul li:before{
                content: "";
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                left: 55px;
                width: 100%;
                height: 2px;
                background: var(--secondary);
            }

            .wrapper .header ul li:last-child:before{
                display: none;
            }

            .wrapper .header ul li div{
                padding: 5px;
                border-radius: 50%;
            }

            .wrapper .header ul li p{
                width: 50px;
                height: 50px;
                background: var(--secondary);
                color: var(--white);
                text-align: center;
                line-height: 50px;
                border-radius: 50%;
                margin: 0
            }

            .wrapper .header ul li.active:before{
                background: var(--primary);
            }

            .wrapper .header ul li.active p{
                background: var(--primary);
            }

            .wrapper .form_wrap{
                margin-bottom: 35px;
            }

            .wrapper .form_wrap h2{
                color: var(--header-clr);
                text-align: center;
                text-transform: uppercase;
                margin-bottom: 20px;
            }

            .wrapper .form_wrap .input_wrap{
                width: 350px;
                max-width: 100%;
                margin: 0 auto 20px;
            }

            .wrapper .form_wrap .input_wrap:last-child{
                margin-bottom: 0;
            }

            .wrapper .form_wrap .input_wrap label{
                display: block;
                margin-bottom: 5px;
            }

            .wrapper .form_wrap .input_wrap .input{
                border: 2px solid var(--secondary);
                border-radius: 3px;
                padding: 10px;
                display: block;
                width: 100%;
                font-size: 16px;
                transition: 0.5s ease;
            }

            .wrapper .form_wrap .input_wrap .input:focus{
                border-color: var(--primary);
            }

            .wrapper .btns_wrap{
                width: 350px;
                max-width: 100%;
                margin: 0 auto;
            }

            .wrapper .btns_wrap .common_btns{
                display: flex;
                justify-content: space-between;
            }

            .wrapper .btns_wrap .common_btns.form_1_btns{
                justify-content: flex-end;
            }

            .wrapper .btns_wrap .common_btns button{
                border: 0;
                padding: 12px 15px;
                background: var(--primary);
                color: var(--white);
                width: 135px;
                justify-content: center;
                display: flex;
                align-items: center;
                font-size: 16px;
                border-radius: 3px;
                transition: 0.5s ease;
                cursor: pointer;
            }

            .wrapper .btns_wrap .common_btns button.btn_back{
                background: var(--secondary);
            }

            .wrapper .btns_wrap .common_btns button.btn_next .icon{
                display: flex;
                margin-left: 10px;
            }

            .wrapper .btns_wrap .common_btns button.btn_back .icon{
                display: flex;
                margin-right: 10px;
            }

            .wrapper .btns_wrap .common_btns button.btn_next:hover,
            .wrapper .btns_wrap .common_btns button.btn_done:hover{
                background: var(--next-btn-hover);
            }

            .wrapper .btns_wrap .common_btns button.btn_back:hover{
                background: var(--back-btn-hover);
            }

            .field_error {
                color: red
            }

            .modal_wrapper{
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                visibility: hidden;
            }

            .modal_wrapper .shadow{
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                opacity: 0;
                transition: 0.2s ease;
            }

            .modal_wrapper .success_wrap{
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%,-800px);
                background: var(--white);
                padding: 50px;
                display: flex;
                align-items: center;
                border-radius: 5px;
                transition: 0.5s ease;
            }

            .modal_wrapper .success_wrap .modal_icon{
                margin-right: 20px;
                width: 50px;
                height: 50px;
                background: var(--primary);
                color: var(--white);
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 32px;
                font-weight: 700;
            }

            .modal_wrapper.active{
                visibility: visible;
            }

            .modal_wrapper.active .shadow{
                opacity: 1;
            }

            .modal_wrapper.active .success_wrap{
                transform: translate(-50%,-50%);
            }

                /* Responsive */
            @media (max-width: 800px) {
            .container {
            flex-direction: column;
            }

            header {
            flex-direction: column;
            }

            .logo-container img {
            height: 40px;
            }

            .bank-name {
            font-size: 20px;
            }

            nav {
            width: 100%;
            left: -100%;
            }

            nav.open {
            left: 0;
            }

            form {
            width: 90%;
            margin: 0 auto;
            }
            }
        </style>
    </head>

    <body>
        <header>
            <div class="logo-container">
                <img src="logo.svg" alt="Bank Logo" />
            </div>
        </header>

        <section class="wrapper">
            <div class="header">
                <ul>
                    <li class="active form_1_progessbar">
                        <div>
                            <p>1</p>
                        </div>
                    </li>
                    <li class="form_2_progessbar">
                        <div>
                            <p>2</p>
                        </div>
                    </li>
                    <li class="form_3_progessbar">
                        <div>
                            <p>3</p>
                        </div>
                    </li>
                    <li class="form_4_progessbar">
                        <div>
                            <p>4</p>
                        </div>
                    </li>
                    <li class="form_5_progessbar">
                        <div>
                            <p>5</p>
                        </div>
                    </li>
                    <li class="form_6_progessbar">
                        <div>
                            <p>6</p>
                        </div>
                    </li>
                </ul>
            </div>

            <form id="loan_form" class="form_wrap">
                <section id="form_section_1" class="form_1 data_info">
                    <h2>Loan Information</h2>
                    <div>
                        <div class="mb-3">
                            <label for="loan_amount" class="form_label">Loan Amount (£)</label>
                            <input type="number" step="0.01" class="form_control" name="loan_amount" id="loan_amount" placeholder="Enter loan amount" oninput="formed.updateField('loan_amount', this.value)">
                            <span class="field_error" id="loan_amount_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="loan_term" class="form_label">Loan Term (months)</label>
                            <input type="number" class="form_control" id="loan_term" name="loan_term" placeholder="Enter loan term" oninput="formed.updateField('loan_term', this.value)">
                            <span class="field_error" id="loan_term_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="existing_customer" class="form_label">Are you an existing customer?</label>
                            <select class="form_select" id="existing_customer" name="existing_customer" onchange="formed.updateField('existing_customer', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                            <span class="field_error" id="existing_customer_error"></span>
                        </div>
                        
                        <div class="mb-3">
                            <label for="loan_purpose" class="form_label">Purpose of the Loan</label>
                            <select class="form_select" id="loan_purpose" name="loan_purpose"  onchange="formed.updateField('loan_purpose', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="personal_loans">Personal Loans</option>
                                <option value="home_loans">Home Loans/Mortgages</option>
                                <option value="home_equity_loans">Home Equity Loans</option>
                                <option value="auto_loans">Auto Loans</option>
                                <option value="business_loans">Business Loans</option>
                                <option value="other">Other</option>
                            </select>
                            <span class="field_error" id="loan_purpose_error"></span>
                        </div>
                    </div>
                </section>

                <section id="form_section_2" class="form_2 data_info" style="display: none;">
                    <h2>Personal Details</h2>
                    <div>
                        <div class="mb-3">
                            <label for="marital_status" class="form_label">Marital Status</label>
                            <select class="form_select" id="marital_status" name="marital_status" onchange="formed.updateField('marital_status', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="single">Single</option>
                                <option value="married">Married</option>
                                <option value="divorced">Divorced</option>
                                <option value="widowed">Widowed</option>
                            </select>
                            <span class="field_error" id="marital_status_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="title" class="form_label">Title</label>
                            <select class="form_select" id="title" name="title" onchange="handleTitleChange(this)">
                                <option value="" selected>Select an option</option>
                                <option value="mr">Mr.</option>
                                <option value="mrs">Mrs.</option>
                                <option value="miss">Miss</option>
                                <option value="ms">Ms.</option>
                                <option value="other">Other</option>
                            </select>
                            <span class="field_error" id="title_error"></span>
                        </div>

                        <div class="mb-3" id="otherTitleContainer" style="display: none;">
                            <label for="otherTitle" class="form_label">Other Title</label>
                            <input type="text" id="otherTitle" name="otherTitle" class="form_input" oninput="formed.updateField('otherTitle', this.value)">
                            <span class="field_error" id="other_title_error"></span>
                        </div>

                        <script>
                            function handleTitleChange(selectElement) {
                                formed.updateField('title', selectElement.value);

                                const otherTitleContainer = document.getElementById("otherTitleContainer");

                                if (selectElement.value === "other") otherTitleContainer.style.display = "block";
                                else otherTitleContainer.style.display = "none";
                            }
                        </script>

                        <div class="mb-3">
                            <label for="first_name" class="form_label">First Name</label>
                            <input type="text" class="form_control" id="first_name" name="first_name" placeholder="Enter first name" oninput="formed.updateField('first_name', this.value)">
                            <span class="field_error" id="first_name_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="last_name" class="form_label">Last Name</label>
                            <input type="text" class="form_control" id="last_name" name="last_name" placeholder="Enter last name" oninput="formed.updateField('last_name', this.value)">
                            <span class="field_error" id="last_name_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="gender" class="form_label">Gender</label>
                            <select class="form_select" id="gender" name="gender" onchange="formed.updateField('gender', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                            <span class="field_error" id="gender_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="dob" class="form_label">Date of Birth</label>
                            <input type="date" class="form_control" id="dob" name="dob" oninput="formed.updateField('dob', this.value)">
                            <span class="field_error" id="dob_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="email" class="form_label">Email</label>
                            <input type="email" class="form_control" id="email" name="email" placeholder="Enter email" oninput="formed.updateField('email', this.value)">
                            <span class="field_error" id="email_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="phone_mobile" class="form_label">Mobile Telephone Number</label>
                            <input type="tel" class="form_control" id="phone_mobile" name="phone_mobile" placeholder="Enter mobile phone number" oninput="formed.updateField('phone_mobile', this.value)">
                            <span class="field_error" id="phone_mobile_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="phone_home" class="form_label">Telephone Number (Home)</label>
                            <input type="tel" class="form_control" id="phone_home" name="phone_home" placeholder="Enter home phone number" oninput="formed.updateField('phone_home', this.value)">
                            <span class="field_error" id="phone_home_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="phone_business" class="form_label">Telephone Number (Business)</label>
                            <input type="tel" class="form_control" id="phone_business" name="phone_business" placeholder="Enter business phone number" oninput="formed.updateField('phone_business', this.value)">
                            <span class="field_error" id="phone_business_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="address" class="form_label">Address</label>
                            <input type="text" id="address" name="address" class="form_control" placeholder="" oninput="formed.updateField('address', this.value)">
                            <span class="field_error" id="address_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="city" class="form_label">City</label>
                            <input type="text" id="city" name="city" class="form_control" placeholder="" oninput="formed.updateField('city', this.value)">
                            <span class="field_error" id="city_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="postcode_result" class="form_label">PostCode</label>
                            <input type="text" id="postcode_result" name="postcode_result" class="form_control" placeholder="" oninput="formed.updateField('postcode_result', this.value)">
                            <span class="field_error" id="postcode_result_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="nationality" class="form_label">Nationality/ies</label>
                            <input type="text" class="form_control" id="nationality" name="nationality" placeholder="Enter nationality" oninput="formed.updateField('nationality', this.value)">
                            <span class="field_error" id="nationality_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="residential_status" class="form_label">Residential Status</label>
                            <select class="form_select" id="residential_status" name="residential_status" onchange="formed.updateField('residential_status', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="homeowner">Homeowner</option>
                                <option value="private_tenant">Private Tenant</option>
                                <option value="council_tenant">Council Tenant</option>
                                <option value="living_with_parents">Living with Parents</option>
                                <option value="other">Other</option>
                            </select>
                            <span class="field_error" id="residential_status_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="id_type" class="form_label">Type of ID</label>
                            <select class="form_select" id="id_type" name="id_type" onchange="formed.updateField('id_type', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="driving_licence">Driving Licence</option>
                                <option value="brp_id">BRP ID</option>
                                <option value="passport">Passport</option>
                                <option value="eu_passport">EU Passport</option>
                                <option value="eu_member_state_id_card">EU Member State ID Card</option>
                            </select>
                            <span class="field_error" id="id_type_error"></span>
                        </div>

                        <div class="mb-3 box" id="driving_licence_box" style="display: none;">
                            <label for="driving_licence" class="form_label">Driving Licence Number</label>
                            <input type="text" id="driving_licence" name="driving_licence" class="form_input" oninput="formed.updateField('driving_licence', this.value)">
                            <span class="field_error" id="driving_licence_error"></span>
                        </div>

                        <div class="mb-3 box" id="brp_id_box" style="display: none;">
                            <label for="brp_id" class="form_label">NI Number</label>
                            <input type="text" id="brp_id" name="brp_id" class="form_input" oninput="formed.updateField('brp_id', this.value)">
                            <span class="field_error" id="brp_id_error"></span>
                        </div>

                        <div class="mb-3 box" id="passport_box" style="display: none;">
                            <label for="passport" class="form_label">Passport Number</label>
                            <input type="text" id="passport" name="passport" class="form_input" oninput="formed.updateField('passport', this.value)">
                            <span class="field_error" id="passport_error"></span>
                        </div>

                        <div class="mb-3 box" id="eu_passport_box" style="display: none;">
                            <label for="eu_passport" class="form_label">EU Passport Number</label>
                            <input type="text" id="eu_passport" name="eu_passport" class="form_input" oninput="formed.updateField('eu_passport', this.value)">
                            <span class="field_error" id="eu_passport_error"></span>
                        </div>

                        <div class="mb-3 box" id="eu_member_state_id_card_box" style="display: none;">
                            <label for="eu_member_state_id_card" class="form_label">EU Member State ID Card Number</label>
                            <input type="text" id="eu_member_state_id_card" name="eu_member_state_id_card"  class="form_input" oninput="formed.updateField('eu_member_state_id_card', this.value)">
                            <span class="field_error" id="eu_member_state_id_card_error"></span>
                        </div>

                        <script>
                            $(document).ready(function(){
                                $('#id_type').on('change', function() {
                                    $('.box').hide();
                                    $('#' + $(this).val() + '_box').show();
                                });
                            });
                        </script>
                    </div>
                </section>

                <section id="form_section_3" class="form_3 data_info" style="display: none;">
                    <h2>Employment Details</h2>
                    <div>
                        <div>
                            <div class="mb-3" id="emp_status">
                                <label for="employment_status" class="form_label">Employment Status</label>
                                <select class="form_select" id="employment_status" name="employment_status" onchange="handleEmploymentStatusChange(this.value)">
                                    <option value="" selected>Select an option</option>
                                    <option value="employed">Employed</option>
                                    <option value="self_employed">Self Employed</option>
                                    <option value="unemployed">Unemployed</option>
                                    <option value="homemaker">Homemaker</option>
                                    <option value="retired">Retired</option>
                                </select>
                                <span class="field_error" id="employment_status_error"></span>
                            </div>

                            <div id="emp" style="display: none">
                                <div class="mb-3">
                                    <label for="employer_name" class="form_label">Employer Name</label>
                                    <input type="text" class="form_control" id="employer_name" name="employer_name" placeholder="Enter employer name" oninput="formed.updateField('employer_name', this.value)">
                                    <span class="field_error" id="employer_name_error"></span>
                                </div>

                                <div class="mb-3">
                                    <label for="occupation" class="form_label">Occupation</label>
                                    <input type="text" class="form_control" id="occupation" name="occupation" placeholder="Enter occupation" oninput="formed.updateField('occupation', this.value)">
                                    <span class="field_error" id="occupation_error"></span>
                                </div>

                                <div class="mb-3">
                                    <label for="employer_address" class="form_label">Employer Address</label>
                                    <input type="text" class="form_control" id="employer_address" name="employer_address" placeholder="Enter employer address" oninput="formed.updateField('employer_address', this.value)">
                                    <span class="field_error" id="employer_address_error"></span>
                                </div>

                                <div class="mb-3">
                                    <label for="time_employment" class="form_label">Time in Employment</label>
                                    <select class="form_select" id="time_employment" name="time_employment" onchange="handleTimeEmploymentChange(this.value)">
                                        <option value="" selected>Select an option</option>
                                        <option value="1">1 Year</option>
                                        <option value="2">2 Years</option>
                                        <option value="3">3 Years</option>
                                        <option value="4">4 Years</option>
                                        <option value="5+">5+ Years</option>
                                    </select>
                                    <span class="field_error" id="time_employment_error"></span>
                                </div>
                            </div>

                            <div class="mb-3" id="self_emp" style="display: none">
                                <label for="self_employed_date" class="form_label">Self-Employed, Please State Date Established</label>
                                <input type="date" class="form_control" id="self_employed_date" name="self_employed_date" oninput="handleSelfEmployedDateChange(this.value)">
                                <span class="field_error" id="self_employed_date_error"></span>
                            </div>

                            <div class="mb-3" id="prev_emp_status" style="display: none">
                                <label for="prev_employment_status" class="form_label">Previous Employment Status</label>
                                <select class="form_select" id="prev_employment_status" name="prev_employment_status" onchange="handlePrevEmploymentStatusChange(this.value)">
                                    <option value="" selected>Select an option</option>
                                    <option value="employed">Employed</option>
                                    <option value="self_employed">Self Employed</option>
                                    <option value="unemployed">Unemployed</option>
                                    <option value="homemaker">Homemaker</option>
                                    <option value="retired">Retired</option>
                                </select>
                                <span class="field_error" id="prev_employment_status_error"></span>
                            </div>

                            <div id="prev_emp" style="display: none">
                                <div class="mb-3">
                                    <label for="prev_employer_name" class="form_label">Previous Employer Name</label>
                                    <input type="text" class="form_control" id="prev_employer_name" name="prev_employer_name" placeholder="Enter previous employer name" oninput="formed.updateField('prev_employer_name', this.value)">
                                    <span class="field_error" id="prev_employer_name_error"></span>
                                </div>

                                <div class="mb-3">
                                    <label for="prev_occupation" class="form_label">Previous Occupation</label>
                                    <input type="text" class="form_control" id="prev_occupation" name="prev_occupation" placeholder="Enter previous occupation" oninput="formed.updateField('prev_occupation', this.value)">
                                    <span class="field_error" id="prev_occupation_error"></span>
                                </div>

                                <div class="mb-3">
                                    <label for="prev_time_employment" class="form_label">Time in Previous Employment</label>
                                    <input type="text" class="form_control" id="prev_time_employment" name="prev_time_employment" placeholder="Enter time in previous employment" oninput="formed.updateField('prev_time_employment', this.value)">
                                    <span class="field_error" id="prev_time_employment_error"></span>
                                </div>
                            </div>

                            <div class="mb-3" id="prev_self_emp" style="display: none">
                                <label for="prev_self_employed_date" class="form_label">Previous Self-Employment Established Date</label>
                                <input type="date" class="form_control" id="prev_self_employed_date" name="prev_self_employed_date" oninput="formed.updateField('prev_self_employed_date', this.value)">
                                <span class="field_error" id="prev_self_employed_date_error"></span>
                            </div>

                            <script>
                                const employerName = document.getElementById("employer_name");
                                const occupation = document.getElementById("occupation");
                                const employerAddress = document.getElementById("employer_address");
                                const timeEmployment = document.getElementById("time_employment");
                                const selfEmployedDate = document.getElementById('self_employed_date');
                                const prevEmploymentStatus = document.getElementById('prev_employment_status');
                                const prevEmployerName = document.getElementById("prev_employer_name");
                                const prevOccupation = document.getElementById("prev_occupation");
                                const prevTimeEmployment = document.getElementById("prev_time_employment");
                                const prevSelfEmployedDate = document.getElementById('prev_self_employed_date');

                                const empElement = document.getElementById('emp');
                                const selfEmpElement = document.getElementById('self_emp');
                                const prevEmpStatusElement = document.getElementById('prev_emp_status');
                                const prevEmpElement = document.getElementById('prev_emp');
                                const prevSelfEmpElement = document.getElementById('prev_self_emp');

                                // utils
                                function beforeYears(numberOfYears) {
                                    const newDate = new Date();

                                    newDate.setFullYear(new Date().getFullYear() - numberOfYears);

                                    return newDate;
                                }

                                // reset controls
                                function resetEmp() {
                                    employerName.value = ""; formed.updateField("employer_name", "");
                                    occupation.value = ""; formed.updateField("occupation", "");
                                    employerAddress.value = ""; formed.updateField("employer_address", "");
                                    timeEmployment.value = ""; formed.updateField("time_employment", "");
                                }

                                function resetSelfEmp() {
                                    selfEmployedDate.value = ""; formed.updateField("self_employed_date", "");
                                }

                                function resetPrevEmpStatus() {
                                    prevEmploymentStatus.value = ""; formed.updateField("prev_employment_status", "");
                                }

                                function resetPrevEmp() {
                                    prevEmployerName.value = ""; formed.updateField("prev_employer_name", "");
                                    prevOccupation.value = ""; formed.updateField("prev_occupation", "");
                                    prevTimeEmployment.value = ""; formed.updateField("prev_time_employment", "");
                                }

                                function resetPrevSelfEmp() {
                                    prevSelfEmployedDate.value = ""; formed.updateField("prev_self_employed_date", "");
                                }

                                // change handlers
                                function handleEmploymentStatusChange(value) {
                                    formed.updateField('employment_status', value);

                                    empElement.style.display = 'none';
                                    selfEmpElement.style.display = 'none';
                                    prevEmpStatusElement.style.display = 'none';
                                    prevEmpElement.style.display = 'none';
                                    prevSelfEmpElement.style.display = 'none';

                                    resetEmp();
                                    resetSelfEmp();
                                    resetPrevEmpStatus();
                                    resetPrevEmp();
                                    resetPrevSelfEmp();

                                    if (value === 'employed') empElement.style.display = 'block';
                                    else if (value === 'self_employed') selfEmpElement.style.display = 'block';
                                }

                                function handleSelfEmployedDateChange(dateValue) {
                                    formed.updateField('self_employed_date', dateValue);

                                    prevEmpElement.style.display = 'none';
                                    prevSelfEmpElement.style.display = 'none';

                                    if (new Date(dateValue) >= beforeYears(3)) prevEmpStatusElement.style.display = 'block';
                                    else {
                                        prevEmpStatusElement.style.display = 'none';

                                        resetPrevEmpStatus();
                                        resetPrevEmp();
                                        resetPrevSelfEmp();
                                    }
                                }

                                function handleTimeEmploymentChange(value) {
                                    formed.updateField('time_employment', value);

                                    if (value === "1" || value === "2") prevEmpStatusElement.style.display = "block";
                                    else {
                                        prevEmpStatusElement.style.display = 'none';
                                        prevEmpElement.style.display = 'none';
                                        prevSelfEmpElement.style.display = 'none';

                                        resetPrevEmpStatus();
                                        resetPrevEmp();
                                        resetPrevSelfEmp();
                                    }
                                }

                                function handlePrevEmploymentStatusChange(value) {
                                    formed.updateField('prev_employment_status', value);

                                    prevEmpElement.style.display = 'none';
                                    prevSelfEmpElement.style.display = 'none';

                                    resetPrevEmp();
                                    resetPrevSelfEmp();

                                    if (value === 'employed') prevEmpElement.style.display = 'block';
                                    else if (value === 'self_employed') prevSelfEmpElement.style.display = 'block';
                                }
                            </script>
                        </div>

                        <div class="mb-3">
                            <label for="annual_gross_salary" class="form_label">Annual Gross Salary</label>
                            <input type="number" class="form_control" id="annual_gross_salary" name="annual_gross_salary" placeholder="Enter annual gross salary" oninput="formed.updateField('annual_gross_salary', this.value)">
                            <span class="field_error" id="annual_gross_salary_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="net_pay_frequency" class="form_label">Net Pay Frequency</label>
                            <select class="form_select" id="net_pay_frequency" name="net_pay_frequency" onchange="formed.updateField('net_pay_frequency', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                            <span class="field_error" id="net_pay_frequency_error"></span>
                        </div>

                        <div class="mb-3 box" id="daily_box" style="display: none;">
                            <label for="daily_net_pay" class="form_label">Daily Net Pay (£)</label>
                            <input type="text" class="form_control" id="daily_net_pay" name="daily_net_pay" placeholder="Enter net pay" oninput="formed.updateField('daily_net_pay', this.value)">
                            <span class="field_error" id="daily_net_pay_error"></span>
                        </div>

                        <div class="mb-3 box" id="weekly_box" style="display: none;">
                            <label for="weekly_net_pay" class="form_label">Weekly Net Pay (£)</label>
                            <input type="text" class="form_control" id="weekly_net_pay" name="weekly_net_pay" placeholder="Enter net pay" oninput="formed.updateField('weekly_net_pay', this.value)">
                            <span class="field_error" id="weekly_net_pay_error"></span>
                        </div>

                        <div class="mb-3 box" id="monthly_box" style="display: none;">
                            <label for="monthly_net_pay" class="form_label">Monthly Net Pay (£)</label>
                            <input type="text" class="form_control" id="monthly_net_pay" name="monthly_net_pay" placeholder="Enter net pay" oninput="formed.updateField('monthly_net_pay', this.value)">
                            <span class="field_error" id="monthly_net_pay_error"></span>
                        </div>

                        <script>
                            $(document).ready(function(){
                                $('#net_pay_frequency').on('change', function() {
                                    $('.box').hide();
                                    $('#' + $(this).val() + '_box').show();
                                });
                            });
                        </script>

                        <div class="mb-3">
                            <label for="other_income" class="form_label">Any other income</label>
                            <select class="form_select" id="other_income" name="other_income" onchange="formed.updateField('other_income', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                            <span class="field_error" id="other_income_error"></span>
                        </div>

                        <div class="mb-3" id="net_annual_income_box" style="display: none;">
                            <label for="net_annual_income" class="form_label">Net Annual Income (£)</label>
                            <input type="text" class="form_control" id="net_annual_income" name="net_annual_income" placeholder="Enter net annual income" oninput="formed.updateField('net_annual_income', this.value)">
                            <span class="field_error" id="net_annual_income_error"></span>
                        </div>

                        <script>
                            $(document).ready(function(){
                                $('#other_income').on('change', function() {
                                    if($(this).val() == "yes") {
                                        $('#net_annual_income_box').show();
                                    } else {
                                        $('#net_annual_income_box').hide();
                                    }
                                });
                            });
                        </script>
                    </div>
                </section>

                <section id="form_section_4" class="form_4 data_info" style="display: none;">
                    <h2>Assets & Property Details</h2>
                    <div>
                        <div class="mb-3">
                            <label for="house_type" class="form_label">House Type</label>
                            <select class="form_select" id="house_type" name="house_type" onchange="formed.updateField('house_type', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="bungalow">Bungalow</option>
                                <option value="flat">Flat</option>
                                <option value="house">House</option>
                            </select>
                            <span class="field_error" id="house_type_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="bedrooms" class="form_label">Number of Bedrooms</label>
                            <select class="form_select" id="bedrooms" name="bedrooms" onchange="formed.updateField('bedrooms', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="studio">Studio</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5+">5+</option>
                            </select>
                            <span class="field_error" id="bedrooms_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="style" class="form_label">Style</label>
                            <select class="form_select" id="style" name="style" onchange="formed.updateField('style', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="detached">Detached</option>
                                <option value="semi_detached">Semi Detached</option>
                                <option value="terrace">Terrace</option>
                                <option value="purpose_built_flat">Purpose Built Flat</option>
                                <option value="converted_flat">Converted Flat</option>
                            </select>
                            <span class="field_error" id="style_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="date_purchased" class="form_label">Date Purchased</label>
                            <input type="date" class="form_control" id="date_purchased" name="date_purchased" oninput="formed.updateField('date_purchased', this.value)">
                            <span class="field_error" id="date_purchased_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="purchase_price" class="form_label">Purchase Price (£)</label>
                            <input type="text" class="form_control" id="purchase_price" name="purchase_price" placeholder="Enter purchase price" oninput="formed.updateField('purchase_price', this.value)">
                            <span class="field_error" id="purchase_price_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="mortgage_outstanding" class="form_label">Mortgage Outstanding (£)</label>
                            <input type="text" class="form_control" id="mortgage_outstanding" name="mortgage_outstanding" placeholder="Enter mortgage outstanding" oninput="formed.updateField('mortgage_outstanding', this.value)">
                            <span class="field_error" id="mortgage_outstanding_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="estimated_present_value" class="form_label">Estimated Present Value (£)</label>
                            <input type="text" class="form_control" id="estimated_present_value" name="estimated_present_value" placeholder="Enter estimated present value" oninput="formed.updateField('estimated_present_value', this.value)">
                            <span class="field_error" id="estimated_present_value_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="monthly_repayment" class="form_label">Monthly Repayment (£)</label>
                            <input type="text" class="form_control" id="monthly_repayment" name="monthly_repayment" placeholder="Enter monthly repayment" oninput="formed.updateField('monthly_repayment', this.value)">
                            <span class="field_error" id="monthly_repayment_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="property_owned" class="form_label">Property Owned</label>
                            <select class="form_select" id="property_owned"  name="property_owned" onchange="formed.updateField('property_owned', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="solely">Solely</option>
                                <option value="jointly">Jointly</option>
                            </select>
                            <span class="field_error" id="property_owned_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="lender" class="form_label">Lender(s)</label>
                            <input type="text" class="form_control" id="lender" name="lender" placeholder="Enter lender(s)" oninput="formed.updateField('lender', this.value)">
                            <span class="field_error" id="lender_error"></span>
                        </div>
                    </div>
                </section>

                <section id="form_section_5" class="form_5 data_info" style="display: none;">
                    <h2>Current Banking Details</h2>
                    <div>
                        <div class="mb-3">
                            <label for="bank_name" class="form_label">Bank Name</label>
                            <input type="text" class="form_control" id="bank_name" name="bank_name" placeholder="Enter bank name" oninput="formed.updateField('bank_name', this.value)">
                            <span class="field_error" id="bank_name_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="account_number" class="form_label">Account Number</label>
                            <input type="text" class="form_control" id="account_number" name="account_number" placeholder="Enter account number" oninput="formed.updateField('account_number', this.value)">
                            <span class="field_error" id="account_number_error"></span>
                        </div>
                        <div class="mb-3">
                            <label for="sort_code" class="form_label">Sort Code</label>
                            <input type="text" class="form_control" id="sort_code" name="sort_code" placeholder="Enter sort code" oninput="formed.updateField('sort_code', this.value)">
                            <span class="field_error" id="sort_code_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="account_type" class="form_label">Type of Account</label>
                            <select class="form_select" id="account_type" name="account_type" onchange="formed.updateField('account_type', this.value)">
                                <option value="" selected>Select an option</option>
                                <option value="checking">Checking</option>
                                <option value="savings">Savings</option>
                                <option value="business">Business</option>
                                <option value="joint">Joint</option>
                            </select>
                            <span class="field_error" id="account_type_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="time_at_bank" class="form_label">Time at Bank</label>
                            <input type="text" class="form_control" id="time_at_bank" name="time_at_bank" placeholder="Enter time at bank" oninput="formed.updateField('time_at_bank', this.value)">
                            <span class="field_error" id="time_at_bank_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="credit_cards" class="form_label">How many credit cards do you have?</label>
                            <input type="number" class="form_control" id="credit_cards" name="credit_cards" placeholder="Enter number of credit cards" oninput="formed.updateField('credit_cards', this.value)">
                            <span class="field_error" id="credit_cards_error"></span>
                        </div>
                    </div>
                </section>

                <section id="form_section_6" class="form_6 data_info" style="display: none;">
                    <h2>Upload Documents</h2>
                    <div>
                        <div class="mb-3">
                            <label for="proof_identity" class="form_label">Upload Proof of Identity (Passport, ID, Driving License)</label>
                            <input type="file" class="form_control" id="proof_identity" name="proof_identity" required>
                            <span class="field_error" id="proof_identity_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="proof_address" class="form_label">Upload Proof of Your Address (Driver's License, Benefits Entitlement Letter, HMRC Tax Notification, Local Authority Tax Bill, Recent Utility Bill, Bank Statement, Tenancy Agreement)</label>
                            <input type="file" class="form_control" id="proof_address" name="proof_address" required>
                            <span class="field_error" id="proof_address_error"></span>
                        </div>

                        <div class="mb-3">
                            <label for="employment_verification" class="form_label">Upload Proof of Your Employment Verification (Payslips for the past 1 year, Bank Statements, Tax Returns)</label>
                            <input type="file" class="form_control" id="employment_verification" name="employment_verification" required>
                            <span class="field_error" id="employment_verification_error"></span>
                        </div>
                    </div>
                </section>

                <div class="btns_wrap">
                    <div class="common_btns form_1_btns">
                        <button id="previous-button" type="button" class="btn_back" style="display: none;" onclick="formed.prevSection()"><span class="icon"><ion-icon name="arrow-back-sharp"></ion-icon></span>Back</button>
                        <button id="next-button" type="button" class="btn_next" onclick="formed.nextSection()">Next <span class="icon"><ion-icon name="arrow-forward-sharp"></ion-icon></span></button>
                    </div>
                </div>
            </form>


            <div class="modal_wrapper">
                <div class="shadow"></div>
                <div class="success_wrap">
                    <span class="modal_icon"><ion-icon name="checkmark-sharp"></ion-icon></span>
                    <p>You have submitted your form successfully.</p>
                </div>
            </div>
        </section>

        <script>
            // const btn_done = document.querySelector(".btn_done");
            // const modal_wrapper = document.querySelector(".modal_wrapper");
            // const shadow = document.querySelector(".shadow");
            //
            // btn_done.addEventListener("click", function(){
            //     modal_wrapper.classList.add("active");
            // });
            //
            // shadow.addEventListener("click", function(){
            //     modal_wrapper.classList.remove("active");
            // });

            const progressBar = [
                document.querySelector(".form_1_progessbar"),
                document.querySelector(".form_2_progessbar"),
                document.querySelector(".form_3_progessbar"),
                document.querySelector(".form_4_progessbar"),
                document.querySelector(".form_5_progessbar"),
                document.querySelector(".form_6_progessbar"),
            ];

            function escapeRegExpSpecialChars(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }

            class Formed {
                constructor({ id, formSchema, onSubmit, buttonIds: { next, previous }, onSectionChange }) {
                    this.formSchema = formSchema;
                    this.values = {};
                    this.errors = {};
                    this.errorSlots = {};
                    this.currentSectionIndex = 0;
                    this.onSubmit = onSubmit;
                    this.prevButtonId = previous;
                    this.nextButtonId = next;
                    this.onSectionChange = onSectionChange;
                    this.currentSectionIndex = 0;
                    this.dirty = false;

                    for (let section of formSchema) {
                        for (let field in section.validationSchema) {
                            this.values[field] = '';
                            this.errors[field] = '';
                            this.errorSlots[field] = document.getElementById(section.validationSchema[field]?.errorSlot);
                        }
                    }

                    document.getElementById(id).addEventListener("submit", (event) => this.submitForm(event));
                }

                validateCurrentSection() {
                    let isSectionValid = true;
                    const currentSchema = this.formSchema[this.currentSectionIndex].validationSchema;

                    for (let field in currentSchema) {
                        if (!this.validateField(field, currentSchema)) isSectionValid = false;
                    }

                    return !isSectionValid;
                }

                validateField(field, currentSchema) {
                    let isFieldValid = true;
                    let errorMessage = '';

                    const checks = currentSchema[field].checks;
                    const errorElement = this.errorSlots[field];

                    const checksToBePerformed = this.values[field] || this.values[field] === 0 || currentSchema[field].requiredField? checks: checks.filter(v => v.custom);

                    for (const check of checksToBePerformed) {
                        if (
                            !(!check?.custom
                                ? check.check(this.values[field])
                                : check.check(this.values[field], this.values))
                        ) {
                            isFieldValid = false;
                            errorMessage = typeof check.message === 'string'
                                ? check.message
                                : check.message(this.values[field], this.values);
                            break;
                        }
                    }

                    this.errors[field] = errorMessage;
                    if (errorElement) errorElement.innerHTML = errorMessage;

                    return isFieldValid;
                }

                nextSection() {
                    this.dirty = this.validateCurrentSection();

                    if (this.currentSectionIndex < this.formSchema.length - 1) {
                        if (!this.dirty) {
                            this.currentSectionIndex++;

                            this.updateSectionDisplay();
                            this.updateNextButton();
                            this.updatePrevButton();
                        }
                    }
                }

                prevSection() {
                    if (this.currentSectionIndex > 0) {
                        this.currentSectionIndex--;

                        this.updateSectionDisplay();
                        this.updateNextButton();
                        this.updatePrevButton();
                    }
                }

                submitForm(event) {
                    if (!this.dirty && this.currentSectionIndex === this.formSchema.length - 1) {
                        this.onSubmit(this.values, event);

                        this.updateSectionDisplay();
                        this.updateNextButton();
                        this.updatePrevButton();
                    }
                }

                updateField(field, value) {
                    if (this.values.hasOwnProperty(field)) {
                        const currentSchema = this.formSchema[this.currentSectionIndex].validationSchema;

                        this.values[field] = value;
                        this.dirty = !this.validateField(field, currentSchema);
                    }
                }

                updateNextButton() {
                    const nextButton = document.getElementById(this.nextButtonId);

                    console.log({ what: this.currentSectionIndex === this.formSchema.length - 1 });

                    if (this.currentSectionIndex === this.formSchema.length - 1) {
                        nextButton.innerText = 'Done';
                        nextButton.setAttribute('type', 'submit');
                    } else {
                        nextButton.innerText = 'Next Section';
                        nextButton.setAttribute('type', 'button');
                    }
                }

                // update the previous button
                updatePrevButton() {
                    const prevButton = document.getElementById(this.prevButtonId);
                    if (this.currentSectionIndex === 0) {
                        prevButton.style.display = 'none';
                    } else {
                        prevButton.style.display = '';
                    }
                }

                updateSectionDisplay() {
                    this.formSchema.forEach(({ id }, index) => {
                        const section = document.getElementById(id);
                        section.style.display = (index === this.currentSectionIndex) ? '' : 'none';
                    });

                    this.onSectionChange(this.formSchema[this.currentSectionIndex].id, this.currentSectionIndex);
                }
            }

            class ValidationSchema {
                Float = /\d+(\.\d+)?/;
                Int = /\d+/;
                Phone = /^\s*(?:\+?(\d{1,3}))?([-. (]*(\d{3})[-. )]*)?((\d{3})[-. ]*(\d{2,4})(?:[-.x ]*(\d+))?)\s*$/;
                Email = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/;
                Date = /^\d{4}-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])$/;

                checks = [];
                errorSlot = undefined;
                requiredField = false;

                oneOf(values, message) {
                    const pattern = new RegExp(`^(${values?.map(v => escapeRegExpSpecialChars(v)).join("|")})$`);
                    this.checks.push({ check: (value) => pattern.test(value), message });
                    return this;
                }

                float(message) {
                    this.checks.push({ check: (value) => Number(value) && this.Float.test(value), message });
                    return this;
                }

                int(message) {
                    this.checks.push({ check: (value) => Number(value) && this.Int.test(value), message });
                    return this;
                }

                string(message) {
                    this.checks.push({ check: (value) => typeof value === "string", message });
                    return this;
                }

                boolean(message) {
                    this.checks.push({ check: (value) => typeof value === "boolean", message });
                    return this;
                }

                date(message) {
                    this.checks.push({ check: (value) => this.Date.test(value), message });
                    return this;
                }

                email(message) {
                    this.checks.push({ check: (value) => this.Email.test(value), message });
                    return this;
                }

                phone(message) {
                    this.checks.push({ check: (value) => this.Phone.test(value), message });
                    return this;
                }

                max(maxValue, message, inclusive) {
                    this.checks.push({ check: (value) => inclusive? value <= maxValue: value < maxValue, message });
                    return this;
                }

                min(minValue, message, inclusive) {
                    this.checks.push({ check: (value) => inclusive? value >= minValue: value < minValue, message });
                    return this;
                }

                maxLength(maxValue, message, inclusive) {
                    this.checks.push({ check: (value) => inclusive? value.length <= maxValue: value.length < maxValue, message });
                    return this;
                }

                minLength(minValue, message, inclusive) {
                    this.checks.push({ check: (value) => inclusive? value.length >= minValue: value.length > minValue, message });
                    return this;
                }

                length(length, message) {
                    this.checks.push({ check: (value) => value.length === length, message });
                    return this;
                }

                required(message) {
                    this.requiredField = true;
                    this.checks.push({ check: (value) =>  !Number.isNaN(value) && value !== null && value !== undefined && value !== '', message });
                    return this;
                }

                custom(check, message) {
                    this.checks.push({ check, message, custom: true });
                    return this;
                }

                constructor(errorSlot) {
                    this.errorSlot = errorSlot;
                    return this;
                }
            }

            function validationSchema(errorSlot) {
                return new ValidationSchema(errorSlot);
            }

            const formed = new Formed({
                id: "loan_form",
                formSchema: [
                    {
                        id: "form_section_1",
                        validationSchema: {
                            loan_amount: validationSchema("loan_amount_error")
                                .required(`Loan amount is required!`)
                                .float(`Invalid loan amount!`),
                            loan_term: validationSchema("loan_term_error")
                                .required(`Loan term is required!`)
                                .int(`Invalid loan term!`),
                            existing_customer: validationSchema("existing_customer_error")
                                .required(`Existing customer is required!`)
                                .oneOf(['yes', 'no'], 'This should be a yes or a no.'),
                            loan_purpose: validationSchema("loan_purpose_error")
                                .required(`Loan purpose is required!`)
                                .oneOf(
                                    [
                                        'personal_loans',
                                        'home_loans',
                                        'home_equity_loans',
                                        'auto_loans',
                                        'business_loans',
                                        'other'
                                    ],
                                    'Customer has to be one of Personal Loans, Home Loans, Home Equity Loans, Auto Loans, Business Loans, or Other!'
                                ),
                        }
                    },
                    {
                        id: "form_section_2",
                        validationSchema: {
                            marital_status: validationSchema("marital_status_error")
                                .required('Marital status is required!')
                                .oneOf(["single", "married", "divorced", "widowed"], 'Invalid marital status!'),
                            title: validationSchema("title_error")
                                .required('Title is required!')
                                .oneOf(["mr", "mrs", "miss", "ms", "other"], 'Invalid title!'),
                            otherTitle: validationSchema("other_title_error")
                                .custom(
                                    (value, values) => values.title === "other"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.title === "other"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Title is required!'
                                            : ''
                                        : ''
                                )
                                .string('Invalid title!'),
                            first_name: validationSchema('first_name_error')
                                .required('First name is required!')
                                .string('Invalid first name!'),
                            last_name: validationSchema('last_name_error')
                                .required('Last name is required!')
                                .string('Invalid last name!'),
                            gender: validationSchema('gender_error')
                                .required('Gender is required!')
                                .oneOf(["male", "female", "other"], 'Invalid gender!'),
                            dob: validationSchema('dob_error')
                                .required('Date is required!')
                                .date('Date is invalid!'),
                            email: validationSchema('email_error')
                                .required('Email is required!')
                                .email('Invalid email!'),
                            phone_mobile: validationSchema('phone_mobile_error')
                                .required('Mobile phone number is required!')
                                .phone('Invalid phone number!'),
                            phone_home: validationSchema('phone_home_error')
                                .phone('Invalid phone number!'),
                            phone_business: validationSchema('phone_business_error')
                                .phone('Invalid phone number!'),
                            address: validationSchema('address_error')
                                .required('Address is required!')
                                .string('Invalid address!'),
                            city: validationSchema('city_error')
                                .required('City is required!')
                                .string('Invalid city!'),
                            postcode_result: validationSchema('postcode_result_error')
                                .required('Postcode result is required!')
                                .string('Invalid postcode!'),
                            nationality: validationSchema('nationality_error')
                                .required('Nationality result is required!')
                                .string('Invalid nationality!'),
                            residential_status: validationSchema('residential_status_error')
                                .required('Residential status is required!')
                                .oneOf(["homeowner", "private_tenant", "council_tenant", "living_with_parents", "other"], 'Invalid residential status!'),
                            id_type: validationSchema('id_type_error')
                                .required('Id type is required!')
                                .oneOf(["driving_licence", "brp_id", "passport", "eu_passport", "eu_member_state_id_card"], 'Invalid id type!'),
                            driving_licence: validationSchema('driving_licence_error')
                                .custom(
                                    (value, values) => values.id_type === "driving_licence"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.id_type === "driving_licence"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Driving license is required!'
                                            : ''
                                        : ''
                                )
                                .string('Invalid driving license!'),
                            brp_id: validationSchema('brp_id_error')
                                .custom(
                                    (value, values) => values.id_type === "brp_id"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.id_type === "brp_id"
                                        ? value === '' || value === undefined || value === null
                                            ? 'BRP id is required!'
                                            : ''
                                        : ''
                                )
                                .string('Invalid BRP id!'),
                            passport: validationSchema('passport_error')
                                .custom(
                                    (value, values) => values.id_type === "passport"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.id_type === "passport"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Passport is required!'
                                            : ''
                                        : ''
                                )
                                .string('Invalid passport!'),
                            eu_passport: validationSchema('eu_passport_error')
                                .custom(
                                    (value, values) => values.id_type === "eu_passport"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.id_type === "eu_passport"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Passport is required!'
                                            : ''
                                        : ''
                                )
                                .string('Invalid passport!'),
                            eu_member_state_id_card: validationSchema('eu_member_state_id_card_error')
                                .custom(
                                    (value, values) => values.id_type === "eu_member_state_id_card"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.id_type === "eu_member_state_id_card"
                                        ? value === '' || value === undefined || value === null
                                            ? 'EU member state id card is required!'
                                            : ''
                                        : ''
                                )
                                .string('Invalid EU member state id card!'),
                        }
                    },
                    {
                        id: "form_section_3",
                        validationSchema: {
                            employment_status: validationSchema("employment_status_error")
                                .required('Employment result is required!')
                                .oneOf(["employed", "self_employed", "unemployed", "homemaker", "retired"], "Invalid employment status!"),
                            employer_name: validationSchema("employer_name_error")
                                .custom(
                                    (value, values) => values.employment_status === "employed"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.employment_status === "employed"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Employer name is required!'
                                            : ''
                                        :  ''
                                )
                                .string("Invalid employer name!"),
                            occupation: validationSchema("occupation_error")
                                .custom(
                                    (value, values) => values.employment_status === "employed"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.employment_status === "employed"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Occupation is required!'
                                            : ''
                                        :  ''
                                )
                                .string("Invalid occupation!"),
                            employer_address: validationSchema("employer_address_error")
                                .custom(
                                    (value, values) => values.employment_status === "employed"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.employment_status === "employed"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Employer address is required!'
                                            : ''
                                        :  ''
                                )
                                .string("Invalid address!"),
                            time_employment: validationSchema("time_employment_error")
                                .custom(
                                    (value, values) => values.employment_status === "employed"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.employment_status === "employed"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Time employment is required!'
                                            : ''
                                        :  ''
                                )
                                .oneOf(["1", "2", "3", "4", "5+"], "Invalid time!"),

                            self_employed_date: validationSchema("self_employed_date_error")
                                .custom(
                                    (value, values) => values.employment_status === "self-employed"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.employment_status === "self-employed"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Self employment date is required!'
                                            : ''
                                        :  ''
                                )
                                .date("Invalid date!"),

                            prev_employment_status: validationSchema("prev_employment_status_error")
                                .custom(
                                    (value, values) => values.time_employment && Number(values.time_employment) < 3 || (values.self_employed_date && beforeYears(3) < new Date(values.self_employed_date))
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.time_employment && Number(values.time_employment) < 3 || (values.self_employed_date && beforeYears(3) < new Date(values.self_employed_date))
                                        ? value === '' || value === undefined || value === null
                                            ? 'Previous employment status is required!'
                                            : ''
                                        :  ''
                                )
                                .oneOf(["employed", "self_employed", "unemployed", "homemaker", "retired"], "Invalid employment status!"),
                            prev_employer_name: validationSchema("prev_employer_name_error")
                                .custom(
                                    (value, values) => values.prev_employment_status === "employed" && (values.time_employment && Number(values.time_employment) < 3 || (values.self_employed_date && beforeYears(3) < new Date(values.self_employed_date)))
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.prev_employment_status === "employed" && (values.time_employment && Number(values.time_employment) < 3 || (values.self_employed_date && beforeYears(3) < new Date(values.self_employed_date)))
                                        ? value === '' || value === undefined || value === null
                                            ? 'Previous employer name is required!'
                                            : ''
                                        :  ''
                                )
                                .string("Invalid employer name!"),
                            prev_occupation: validationSchema("prev_occupation_error")
                                .custom(
                                    (value, values) => values.prev_employment_status === "employed" && (values.time_employment && Number(values.time_employment) < 3 || (values.self_employed_date && beforeYears(3) < new Date(values.self_employed_date)))
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.prev_employment_status === "employed" && (values.time_employment && Number(values.time_employment) < 3 || (values.self_employed_date && beforeYears(3) < new Date(values.self_employed_date)))
                                        ? value === '' || value === undefined || value === null
                                            ? 'Previous occupation is required!'
                                            : ''
                                        :  ''
                                )
                                .string("Invalid occupation!"),
                            prev_time_employment: validationSchema("prev_time_employment_error")
                                .custom(
                                    (value, values) => values.prev_employment_status === "employed" && (values.time_employment && Number(values.time_employment) < 3 || (values.self_employed_date && beforeYears(3) < new Date(values.self_employed_date)))
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.prev_employment_status === "employed" && (values.time_employment && Number(values.time_employment) < 3 || (values.self_employed_date && beforeYears(3) < new Date(values.self_employed_date)))
                                        ? value === '' || value === undefined || value === null
                                            ? 'Previous employment time is required!'
                                            : ''
                                        :  ''
                                )
                                .int("Invalid time!"),

                            prev_self_employed_date: validationSchema("prev_self_employed_date_error")
                                .custom(
                                    (value, values) => values.prev_employment_status === "self-employed" && values.self_employed_date && beforeYears(3) < new Date(values.self_employed_date)
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.prev_employment_status === "self-employed" && values.self_employed_date && beforeYears(3) < new Date(values.self_employed_date)
                                        ? value === '' || value === undefined || value === null
                                            ? 'Previous self employed date is required!'
                                            : ''
                                        :  ''
                                )
                                .date("Invalid date!"),

                            annual_gross_salary: validationSchema("annual_gross_salary_error")
                                .required("Annual gross salary is required!")
                                .float('Invalid salary!'),

                            net_pay_frequency: validationSchema("net_pay_frequency_error")
                                .required("Net pay frequency is required!")
                                .oneOf(["daily", "weekly", "monthly"], 'Invalid net pay frequency!'),
                            daily_net_pay: validationSchema("daily_net_pay_error")
                                .custom(
                                    (value, values) => values.other_income === "daily"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.other_income === "daily"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Net annual income is required!'
                                            : ''
                                        :  ''
                                )
                                .float(`Invalid net pay!`),
                            weekly_net_pay: validationSchema("weekly_net_pay_error")
                                .custom(
                                    (value, values) => values.other_income === "weekly"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.other_income === "weekly"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Net annual income is required!'
                                            : ''
                                        :  ''
                                )
                                .float(`Invalid net pay!`),
                            monthly_net_pay: validationSchema("monthly_net_pay_error")
                                .custom(
                                    (value, values) => values.other_income === "month"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.other_income === "month"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Net annual income is required!'
                                            : ''
                                        :  ''
                                )
                                .float(`Invalid net pay!`) ,

                            other_income: validationSchema("other_income_error")
                                .required('Other income is require!')
                                .oneOf(["yes", "no"], "Invalid income!"),
                            net_annual_income: validationSchema("net_annual_income_error")
                                .custom(
                                    (value, values) => values.other_income === "yes"
                                        ? value !== '' && value !== undefined && value !== null
                                        : true,
                                    (value, values) => values.other_income === "yes"
                                        ? value === '' || value === undefined || value === null
                                            ? 'Net annual income is required!'
                                            : ''
                                        : ''
                                )
                                .float(`Invalid income!`),
                        }
                    },
                    {
                        id: "form_section_4",
                        validationSchema: {
                            house_type: validationSchema("house_type_error")
                                .required("House type is required!")
                                .oneOf(["bungalow", "flat", "house"], "Invalid house type!"),
                            bedrooms: validationSchema("bedrooms_error")
                                .required("Number of bedrooms is required!")
                                .oneOf(["studio", "1", "2", "3", "4", "5+"], "Invalid number of bedrooms!"),
                            style: validationSchema("style_error")
                                .required("Style is required!")
                                .oneOf(["detached", "semi_detached", "terrace", "purpose_built_flat", "converted_flat"], "Invalid style!"),
                            date_purchased: validationSchema("date_purchased_error")
                                .required("Date purchased is required!")
                                .date("Invalid date!"),
                            purchase_price: validationSchema("purchase_price_error")
                                .required("Purchase price is required!")
                                .float('Invalid price!'),
                            mortgage_outstanding: validationSchema("mortgage_outstanding_error")
                                .required("Mortgage outstanding is required!")
                                .float('Invalid outstanding value!'),
                            estimated_present_value: validationSchema("estimated_present_value_error")
                                .required("Estimated present value is required!")
                                .float('Invalid estimated present value!'),
                            monthly_repayment: validationSchema("monthly_repayment_error")
                                .required("Monthly repayment is required!")
                                .float('Invalid payment!'),
                            property_owned: validationSchema("property_owned_error")
                                .required("Property ownership is required!")
                                .oneOf(["solely", "jointly"], "Invalid property ownership!"),
                            lender: validationSchema("lender_error")
                                .required("Lender is required!")
                                .string("Invalid lender!"),
                        }
                    },
                    {
                        id: "form_section_5",
                        validationSchema: {
                            bank_name: validationSchema("bank_name_error")
                                .required("Bank name is required!")
                                .string("Invalid bank name!"),
                            account_number: validationSchema("account_number_error")
                                .required("Account number is required!")
                                .int("Invalid account number!"),
                            sort_code: validationSchema("sort_code_error")
                                .required("Sort code is required!")
                                .int("Invalid sort code!")
                                .length(6, "Sort code should be a 6 digit number."),
                            account_type: validationSchema("account_type_error")
                                .required("Account type is required!")
                                .oneOf(["checking", "savings", "business", "joint"], "Invalid account type!"),
                            time_at_bank: validationSchema("time_at_bank_error")
                                .required("Time at bank is required!")
                                .int('Invalid time!'),
                            credit_cards: validationSchema("credit_cards_error")
                                .required("Number of credit cards is required!")
                                .int('Invalid number of credit cards!'),
                        }
                    },
                    {
                        id: "form_section_6",
                        validationSchema: {}
                    }
                ],
                buttonIds: { previous: "previous-button", next: "next-button" },
                onSectionChange: (sectionId, sectionIndex) => {
                    for(let i = 0; i < progressBar.length; i++) {
                        if (i <= sectionIndex) progressBar[i].classList.add("active");
                        else progressBar[i].classList.remove("active");
                    }
                },
                onSubmit: (values, event) => {
                    console.log({ values });

                    event.preventDefault();

                    fetch("http://localhost:3000/submit", {
                        method: 'POST',
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(values)
                    })
                        .then((response) => {
                            if (response.status === 500) {
                                // TODO HANDLE THE ERROR
                                // MAYBE ALERT THE USER THAT SHIT DID NOT GO THE WAY THEY WANTED
                                alert("Error 500");

                                return;
                            }

                            alert("Success");
                            // TODO HANDLE RESPONSE
                            // MAYBE NAVIGATE TO THE NEXT SCREEN
                            // SOMETHING LIKE
                            // window.location.href = 'https://www.example.com';
                        })
                        .catch((err) => {
                            console.error(err)

                            alert("Could not fetch!")
                            // TODO HANDLE THE ERROR
                            // MAYBE ALERT THE USER THAT SHIT DID NOT GO THE WAY THEY WANTED
                        });
                }
            });
        </script>
    </body>
    
</html>
